<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zen Hub — Welcome</title>
<style>
  /* -------------------------
     Zen Colors & base layout
     ------------------------- */
  :root{
    --zen-bg-1: #ffe6f2;
    --zen-bg-2: #fff0f6;
    --card-bg: #fff6fa;
    --text-dark: #a14a76;
    --text-muted: #c77fa7;
    --accent-1: #ffb7d5;
    --accent-2: #ff6f91;
    --border: rgba(255, 183, 213, 0.5);
    --shadow: 0 4px 20px rgba(255, 111, 145, 0.08);
    --petal: #ffb7d5;
    --petal-dark: #ff6f91;
  }
  .dark{
    --zen-bg-1: #2d1a2c;
    --zen-bg-2: #4a274a;
    --card-bg: #3a1f3d;
    --text-dark: #ffe6f2;
    --text-muted: #ffb7d5;
    --accent-1: #ff6f91;
    --accent-2: #a14a76;
    --border: rgba(255, 183, 213, 0.18);
    --shadow: 0 4px 20px rgba(255, 111, 145, 0.18);
    --petal: #ff6f91;
    --petal-dark: #a14a76;
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    margin:0; min-height:100vh; min-width:100vw; overflow-x:hidden; overflow-y:auto;
    display:block;
    background: linear-gradient(120deg, var(--zen-bg-1) 0%, var(--zen-bg-2) 40%, var(--accent-1) 100%);
    animation: sakuraGradientMove 16s ease-in-out infinite alternate;
    transition: background 700ms ease, color 400ms ease;
    color:var(--text-dark);
    position:relative;
  }

  @keyframes sakuraGradientMove {
    0% { background-position: 0% 50%; }
    100% { background-position: 100% 50%; }
  }

  /* Sakura petals floating */
  .sakura-petal {
    position: absolute;
    width: 32px;
    height: 32px;
    pointer-events: none;
    z-index: 1;
    opacity: 0.7;
    animation: petalFloat 12s linear infinite;
  }
  @keyframes petalFloat {
    0% { transform: translateY(-40px) rotate(0deg) scale(1); opacity:0.7; }
    50% { transform: translateY(60vh) rotate(40deg) scale(1.1); opacity:0.9; }
    100% { transform: translateY(100vh) rotate(80deg) scale(0.9); opacity:0.3; }
  }

  /* -------------------------
     ENTRY overlay / layout (fullscreen)
     ------------------------- */
  #entryOverlay{
    position:fixed; inset:0; z-index:4000;
    display:flex; align-items:center; justify-content:center; pointer-events:auto;
    background: linear-gradient(180deg, rgba(8,3,8,1), rgba(12,4,12,1));
  }
  #entryInner{
    display:flex; flex-direction:column; align-items:center; gap:12px; text-align:center; color:#e8eef3;
    pointer-events:auto;
  }

  #entryTitle{
    font-size:1.8rem; font-weight:300; opacity:0; transform: translateY(6px);
    transition: opacity 420ms ease, transform 420ms ease;
    letter-spacing: -0.5px;
  }
  #entrySub{
    margin-top:4px; color:#cbd5e0; opacity:0; transform: translateY(6px);
    transition: opacity 420ms ease 120ms, transform 420ms ease 120ms;
    font-size:1.05rem;
  }

  /* Three container (rounded) */
  #threeWrap{ width:480px; height:480px; display:flex; align-items:center; justify-content:center; pointer-events:auto; }
  #threeContainer{ width:100%; height:100%; border-radius:50%; overflow:visible; }

  /* main app (hidden until reveal) */
  .app { 
    width:100%; max-width:1000px; position:relative; z-index:10; 
    opacity:0; transform:translateY(12px); 
    transition:opacity 600ms ease, transform 500ms ease; 
    pointer-events:none; padding:32px 18px 18px 18px; box-sizing:border-box; 
    margin:0 auto;
    min-height:calc(100vh - 32px);
    background:transparent;
    overflow:visible;
    display:block;
  }
  .app.visible{ opacity:1; transform:translateY(0); pointer-events:auto; }

  header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:40px; flex-wrap:wrap; gap:16px; position:relative; margin-top:12px; }
  .title-wrap{ display:flex; gap:18px; align-items:center; }
  .logo-zen {
    width:56px;height:56px;border-radius:16px;
    background:linear-gradient(135deg,var(--accent-1),var(--accent-2));
    display:flex;align-items:center;justify-content:center;
    color:white;font-weight:700;font-size:2.1rem;box-shadow:0 4px 16px rgba(255,111,145,0.18);
    letter-spacing:2px;
    border:2px solid #fff2;
    margin-right:2px;
    animation: logoPulse 2.5s infinite alternate;
    position:relative;
    overflow:visible;
  }
  .logo-zen::after {
    content: '';
    position: absolute;
    right: -12px; top: -10px;
    width: 22px; height: 22px;
    background: url('data:image/svg+xml;utf8,<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="11" cy="11" rx="10" ry="6" fill="%23ffb7d5"/><ellipse cx="11" cy="11" rx="6" ry="10" fill="%23ff6f91" opacity="0.5"/></svg>');
    opacity:0.7;
    z-index:2;
  }
  @keyframes logoPulse {
    0% { box-shadow:0 4px 16px rgba(255,111,145,0.18); }
    100% { box-shadow:0 8px 32px rgba(255,183,213,0.28); }
  }
  h1{ font-size:2.2rem; color:var(--text-dark); margin:0; font-weight:400; letter-spacing:-0.5px; }
  .subtitle{ color:var(--text-muted); font-size:1.15rem; margin-top:4px; font-weight:400; letter-spacing:0.2px; }
  .tagline { color:var(--accent-2); font-size:1.05rem; font-weight:500; margin-top:2px; letter-spacing:0.5px; }

  .controls{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .search{ 
    display:flex; gap:8px; align-items:center; border-radius:10px; 
    padding:10px 14px; border:1px solid var(--border); 
    background:var(--card-bg); box-shadow:var(--shadow); 
  }
  .search input{ 
    border:0; outline:0; background:transparent; 
    color:var(--text-dark); width:260px; font-size:1rem;
  }
  .search input::placeholder{ color:var(--text-muted); }

  .btn{
    padding:10px 14px; border-radius:10px; cursor:pointer; 
    font-weight:600; border:1px solid var(--border);
    background:var(--card-bg); color:var(--text-dark);
    transition:all 0.3s cubic-bezier(.4,0,.2,1);
    box-shadow:0 2px 8px rgba(255,111,145,0.08);
    position:relative;
    overflow:hidden;
  }
  .btn:hover{
    transform:translateY(-2px) scale(1.04);
    box-shadow:0 12px 32px rgba(255,111,145,0.22);
    background:linear-gradient(135deg, var(--accent-1) 60%, var(--accent-2) 100%);
    color:white;
  }

  .grid{ 
    display:grid; 
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
    gap:30px; 
  }
  
  .card{ 
    background:var(--card-bg); 
    border-radius:20px; 
    padding:54px 38px; 
    text-align:center; 
    border:1px solid var(--border); 
    box-shadow:0 8px 32px rgba(255,111,145,0.10); 
    transition:all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
    display:flex; 
    flex-direction:column; 
    align-items:center;
    justify-content:center; 
    min-height:220px; 
    cursor:pointer;
    position:relative;
    overflow:hidden;
    backdrop-filter: blur(2px);
  }
  .card::after {
    content: '';
    position: absolute;
    left: 12px; bottom: 10px;
    width: 28px; height: 28px;
    background: url('data:image/svg+xml;utf8,<svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="14" cy="14" rx="13" ry="7" fill="%23ffb7d5"/><ellipse cx="14" cy="14" rx="7" ry="13" fill="%23ff6f91" opacity="0.5"/></svg>');
    opacity:0.5;
    z-index:0;
  }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
    transform: scaleX(0);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .card:hover{ 
    transform:translateY(-10px) scale(1.03); 
    box-shadow:0 32px 64px rgba(102,126,234,0.18); 
    border-color:rgba(102, 126, 234, 0.38);
    background:linear-gradient(120deg, var(--accent-1) 10%, var(--card-bg) 90%);
  }
  
  .card:hover::before {
    transform: scaleX(1);
  }

  .card-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 25px;
    background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .card:hover .card-icon {
    transform: scale(1.1) rotate(5deg);
  }

  .card-icon svg {
    width: 32px;
    height: 32px;
    stroke: white;
    stroke-width: 2;
    fill: none;
  }

  .card-title{ 
    font-weight:700; 
    color:var(--accent-2); 
    font-size:1.6em; 
    margin-bottom:12px;
    letter-spacing:-0.3px;
    text-shadow:0 2px 8px rgba(255,111,145,0.08);
  }
  .card-desc{ 
    color:var(--text-muted); 
    font-size:1.08em; 
    line-height:1.7;
    margin-bottom:8px;
  }

  .add-card{ 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    min-height:200px; 
    border-radius:16px; 
    background:linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); 
    border:2px dashed var(--border); 
    font-size:3rem; 
    color:var(--text-muted); 
    cursor:pointer;
    transition:all 0.3s ease;
  }
  
  .add-card:hover{
    background:linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    border-color:var(--accent-1);
    color:var(--accent-1);
    transform:scale(1.02);
  }

  /* modal */
  .modal{ 
    position:fixed; inset:0; display:flex; 
    align-items:center; justify-content:center; 
    z-index:5000; 
    background:rgba(0,0,0,0.4); 
    backdrop-filter: blur(8px); 
    opacity:0; pointer-events:none; 
    transition:opacity 300ms; 
  }
  .modal.show{ opacity:1; pointer-events:auto; }
  
  .modal-card{ 
    width:100%; max-width:520px; 
    background:var(--card-bg); 
    border-radius:20px; 
    padding:40px; 
    border:1px solid var(--border); 
    box-shadow:0 20px 60px rgba(0,0,0,0.2);
    animation: slideUp 0.3s ease;
  }
  
  .modal-card h3{
    font-size:1.8em;
    color:var(--text-dark);
    margin-bottom:30px;
    font-weight:600;
  }
  
  .form-group{
    margin-bottom:25px;
  }
  
  .form-group label{
    display:block;
    color:var(--text-dark);
    font-size:0.95em;
    margin-bottom:8px;
    font-weight:500;
  }
  
  .form-group input,
  .form-group textarea{
    width:100%;
    padding:12px 16px;
    border:2px solid var(--border);
    border-radius:10px;
    font-size:1em;
    transition:all 0.3s ease;
    font-family:inherit;
    background:var(--card-bg);
    color:var(--text-dark);
  }
  
  .form-group input:focus,
  .form-group textarea:focus{
    outline:none;
    border-color:var(--accent-1);
    box-shadow:0 0 0 3px rgba(102, 126, 234, 0.1);
  }
  
  .form-group textarea{
    resize:vertical;
    min-height:80px;
  }
  
  .modal-actions{ 
    display:flex; 
    gap:15px; 
    margin-top:30px; 
  }
  
  .btn-primary{ 
    flex:1;
    background:linear-gradient(135deg, var(--accent-1), var(--accent-2)); 
    color:white;
    border:none;
  }
  
  .btn-primary:hover{
    transform:translateY(-2px);
    box-shadow:0 8px 20px rgba(102, 126, 234, 0.3);
  }
  
  .btn-secondary{
    flex:1;
    background:var(--card-bg);
    color:var(--text-dark);
  }

  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* responsive */
  @media (max-width:860px){
    #threeWrap{ width:360px; height:360px; }
    .search input{ width:160px; }
    .grid{ gap:20px; }
    h1{ font-size:1.5rem; }
    .card{ padding:40px 25px; }
  }
</style>
</head>
<body>
  <!-- ENTRY overlay -->
  <div id="entryOverlay" role="dialog" aria-modal="true" aria-label="Entry overlay" tabindex="0">
    <div id="entryInner">
      <div id="threeWrap"><div id="threeContainer" aria-hidden="true"></div></div>
  <div id="entryTitle">Welcome Babies</div>
  <div id="entrySub">Tap to enter, Babies</div>
    </div>
  </div>

  <!-- Main app -->
  <div class="app" id="appRoot" aria-hidden="true">
    <!-- Sakura petals -->
    <div class="sakura-petal" style="left:8vw;top:-32px;animation-delay:0s;"></div>
    <div class="sakura-petal" style="left:22vw;top:-32px;animation-delay:2s;"></div>
    <div class="sakura-petal" style="left:38vw;top:-32px;animation-delay:4s;"></div>
    <div class="sakura-petal" style="left:60vw;top:-32px;animation-delay:1.5s;"></div>
    <div class="sakura-petal" style="left:80vw;top:-32px;animation-delay:3.2s;"></div>
    <header>
      <div class="title-wrap">
        <div class="logo-zen">Z</div>
        <div>
          <h1>Welcome Babies</h1>
          <div class="subtitle">Choose your destination, Babies</div>
          <div class="tagline">Sakura Hub: Blossom into productivity, Babies</div>
        </div>
      </div>
      <div class="controls">
        <div class="search" role="search">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
            <circle cx="11" cy="11" r="7" stroke="currentColor" stroke-width="1.6"/>
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <input id="searchInput" placeholder="Search..." aria-label="Search categories">
        </div>
        <button id="openAdd" class="btn" title="Add category">+</button>
        <button id="themeToggle" class="btn" title="Toggle theme">🌙</button>
      </div>
    </header>

    <main>
      <section>
        <div id="cardGrid" class="grid" aria-live="polite">
          <!-- cards will be inserted here -->
        </div>
      </section>
    </main>
    <footer style="width:100%;text-align:center;margin-top:38px;color:var(--text-muted);font-size:1.08em;letter-spacing:0.2px;">
      <hr style="border:none;border-top:1px solid var(--border);margin:18px 0 12px 0;">
      <span>“Let your dreams blossom like sakura petals.”</span>
    </footer>
  </div>

  <!-- modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <h3 id="modalTitle">Add Category</h3>
      <div class="form-group">
        <label>Title</label>
        <input id="cardTitle" type="text" placeholder="e.g., Projects" required>
      </div>
      <div class="form-group">
        <label>Description</label>
        <textarea id="cardDesc" placeholder="Brief description" required></textarea>
      </div>
      <div class="form-group">
        <label>URL</label>
        <input id="cardUrl" type="url" placeholder="https://example.com" required>
      </div>
      <div class="modal-actions">
        <button id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button id="modalSave" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <!-- soft chime -->
  <audio id="chimeAudio" preload="auto">
    <source src="data:audio/wav;base64,UklGRlQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQgAAAA=" type="audio/wav">
  </audio>

  <!-- three.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.min.js"></script>

<script>
/* ============================================================
   Zen Hub with Three.js orb intro
   ============================================================ */

/* ---------- DOM references ---------- */
const entryOverlay = document.getElementById('entryOverlay');
const entryTitle = document.getElementById('entryTitle');
const entrySub = document.getElementById('entrySub');
const threeContainer = document.getElementById('threeContainer');
const appRoot = document.getElementById('appRoot');
const chime = document.getElementById('chimeAudio');

const cardGrid = document.getElementById('cardGrid');
const openAdd = document.getElementById('openAdd');
const modal = document.getElementById('modal');
const modalSave = document.getElementById('modalSave');
const modalCancel = document.getElementById('modalCancel');
const cardTitle = document.getElementById('cardTitle');
const cardDesc = document.getElementById('cardDesc');
const cardUrl = document.getElementById('cardUrl');
const searchInput = document.getElementById('searchInput');
const themeToggle = document.getElementById('themeToggle');

const STORAGE_KEY = 'zen_hub_categories';

/* ---------- text fade sequence ---------- */
function fadeInTextSequence(){
  setTimeout(()=>{ entryTitle.style.opacity = '1'; entryTitle.style.transform = 'translateY(0)'; }, 500);
  setTimeout(()=>{ entrySub.style.opacity = '1'; entrySub.style.transform = 'translateY(0)'; }, 900);
}
fadeInTextSequence();

/* ======================
   THREE.JS ORB
   ====================== */
let scene, camera, renderer, geometry, material, points;
let particleCount = 3000;
let positions, basePositions, sizes;
let t = 0;
let mouse = {x:0,y:0}, rotationTarget = {x:0,y:0};
let pulse = 0;
let rafID;
let breathingStarted = false;
let parallax = 0;

function initOrb(){
  scene = new THREE.Scene();
  const W = threeContainer.clientWidth || 480;
  const H = threeContainer.clientHeight || 480;
  camera = new THREE.PerspectiveCamera(50, W/H, 0.1, 3000);
  camera.position.z = 420;

  renderer = new THREE.WebGLRenderer({ alpha:true, antialias:true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.setSize(W,H);
  renderer.domElement.style.display = 'block';
  threeContainer.appendChild(renderer.domElement);

  geometry = new THREE.BufferGeometry();
  positions = new Float32Array(particleCount*3);
  basePositions = new Float32Array(particleCount*3);
  sizes = new Float32Array(particleCount);

  for(let i=0;i<particleCount;i++){
    const u = Math.random(), v = Math.random();
    const theta = 2*Math.PI*u, phi = Math.acos(2*v - 1);
    const r = 150 + (Math.random()-0.5) * 7;
    const x = r * Math.sin(phi) * Math.cos(theta);
    const y = r * Math.sin(phi) * Math.sin(theta);
    const z = r * Math.cos(phi);
    basePositions[3*i] = x; basePositions[3*i+1] = y; basePositions[3*i+2] = z;
    positions[3*i] = x; positions[3*i+1] = y; positions[3*i+2] = z;
    sizes[i] = 1 + Math.random()*2.2;
  }

  geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  geometry.setAttribute('aSize', new THREE.BufferAttribute(sizes, 1));

  const sprite = new THREE.Texture(makeSprite());
  sprite.needsUpdate = true;

  material = new THREE.PointsMaterial({
    size:6, map:sprite, transparent:true, depthWrite:false, blending:THREE.AdditiveBlending, opacity:0.92
  });

  points = new THREE.Points(geometry, material);
  scene.add(points);

  window.addEventListener('resize', onResize);
  threeContainer.addEventListener('pointermove', onPointerMove);
  threeContainer.addEventListener('pointerdown', ()=> pulse = Math.min(3, pulse + 1.6));
  window.addEventListener('scroll', onParallax);

  animate();
}

function onParallax(){
  parallax = window.scrollY * 0.02;
}

function makeSprite(){
  const size = 128;
  const c = document.createElement('canvas');
  c.width = c.height = size;
  const ctx = c.getContext('2d');
  const g = ctx.createRadialGradient(size/2,size/2,2,size/2,size/2,size/2);
  g.addColorStop(0,'rgba(102, 126, 234,1)');
  g.addColorStop(0.12,'rgba(118, 75, 162,0.95)');
  g.addColorStop(0.35,'rgba(102, 126, 234,0.72)');
  g.addColorStop(1,'rgba(102, 126, 234,0)');
  ctx.fillStyle = g; ctx.fillRect(0,0,size,size);
  return c;
}

function onResize(){
  const W = threeContainer.clientWidth || 480;
  const H = threeContainer.clientHeight || 480;
  camera.aspect = W/H;
  camera.updateProjectionMatrix();
  renderer.setSize(W,H);
}

function onPointerMove(e){
  const r = threeContainer.getBoundingClientRect();
  mouse.x = ((e.clientX - r.left) / r.width) * 2 - 1;
  mouse.y = -(((e.clientY - r.top) / r.height) * 2 - 1);
  rotationTarget.x = mouse.y * 0.45;
  rotationTarget.y = mouse.x * 0.45;
}

function startBreathing(){ breathingStarted = true; }

function animate(){
  t += 0.014;
  points.rotation.x += (rotationTarget.x - points.rotation.x) * 0.06 + parallax * 0.01;
  points.rotation.y += (rotationTarget.y - points.rotation.y) * 0.06 + parallax * 0.01;

  const baseAmp = breathingStarted ? 18 : 6;
  const spikeFactor = breathingStarted ? (1 + Math.sin(t * 2.0) * 0.6) : 1.0;

  for(let i=0;i<particleCount;i++){
    const bx = basePositions[3*i], by = basePositions[3*i+1], bz = basePositions[3*i+2];
    const ang = Math.atan2(by, bx);
    const n = Math.sin(ang * (3 + Math.sin(i*0.003)*0.2) + t * (1.6 + (i%7)*0.001)) * (baseAmp * spikeFactor)
            + Math.sin((bx+by+t*8) * 0.03) * 3
            + (Math.sin(t + i*0.01) * 1.4);
    const px = mouse.x * 30, py = mouse.y * 30;
    const dx = bx + (px * 0.06) * (1 - Math.abs(by)/220);
    const dy = by + (py * 0.06) * (1 - Math.abs(bx)/220);
    positions[3*i]   = bx + (n * (0.9 + pulse*0.12)) + (dx - bx) * 0.03;
    positions[3*i+1] = by + (n * (0.6 + pulse*0.08)) + (dy - by) * 0.03;
    positions[3*i+2] = bz + Math.cos(t * 1.2 + i*0.01) * 2;
  }
  geometry.attributes.position.needsUpdate = true;
  pulse *= 0.92;

  if(breathingStarted){
    material.opacity = 0.82 + 0.12 * Math.sin(t * 1.9);
    material.size = 5 + 1.8 * (1 + Math.sin(t * 1.9));
  } else {
    material.opacity = 0.9;
    material.size = 5.0;
  }

  points.rotation.y += 0.0009;

  renderer.render(scene, camera);
  rafID = requestAnimationFrame(animate);
}

/* initialize orb */
initOrb();
setTimeout(()=> startBreathing(), 1000);

/* ======================
   Reveal: calm expand + fade -> show hub
   ====================== */
let revealed = false;
async function revealToHub(){
  if(revealed) return;
  revealed = true;
  try{ chime.currentTime = 0; await chime.play(); } catch(e){}

  pulse = 2.4;
  const canvas = threeContainer.querySelector('canvas');

  if(canvas){
    canvas.style.transition = 'transform 760ms cubic-bezier(.2,.9,.2,1), opacity 760ms ease';
    canvas.style.transformOrigin = '50% 50%';
    canvas.style.transform = 'scale(1.06)';
    setTimeout(()=> {
      canvas.style.transform = 'scale(1.5)';
      canvas.style.opacity = '0';
      entryTitle.style.opacity = '0';
      entrySub.style.opacity = '0';
      entryOverlay.style.transition = 'opacity 760ms ease';
      entryOverlay.style.opacity = '0';
    }, 200);
  } else {
    entryOverlay.style.opacity = '0';
  }

  setTimeout(()=>{
    try{ cancelAnimationFrame(rafID); } catch(e){}
    try{ entryOverlay.remove(); } catch(e){}
    document.body.style.background = `linear-gradient(135deg, var(--zen-bg-1), var(--zen-bg-2))`;
    appRoot.classList.add('visible');
    appRoot.setAttribute('aria-hidden','false');
    loadOrInitCategories();
  }, 960);
}

entryOverlay.addEventListener('click', revealToHub);
entryOverlay.addEventListener('keydown', (e)=> { if(e.key === 'Enter' || e.key === ' ') revealToHub(); });

/* =========================
   Categories / modal / storage
   ========================= */
let categories = JSON.parse(localStorage.getItem(STORAGE_KEY) || 'null');
const defaultCats = [
  { id:'assignments', title:'Assignments', description:'Plan and manage your tasks', url:'https://wasp832.github.io/PlanneR/' },
  { id:'workouts', title:'Workouts', description:'Track your fitness journey', url:'https://wasp832.github.io/FitPro/' },
  { id:'food', title:'Food', description:'Discover and share recipes', url:'https://wasp832.github.io/FoodVibe/' }
];

const icons = {
  assignments: '<svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
  workouts: '<svg viewBox="0 0 24 24"><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>',
  food: '<svg viewBox="0 0 24 24"><path d="M18 8h1a4 4 0 0 1 0 8h-1"></path><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"></path><line x1="6" y1="1" x2="6" y2="4"></line><line x1="10" y1="1" x2="10" y2="4"></line><line x1="14" y1="1" x2="14" y2="4"></line></svg>',
  default: '<svg viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg>'
};

function saveCategories(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(categories)); }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function renderCategories(list){
  cardGrid.innerHTML = '';
  list.forEach(cat => {
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.id = cat.id;
    const icon = icons[cat.id] || icons.default;
    el.innerHTML = `
      <div class="card-icon">${icon}</div>
      <div class="card-title">${escapeHtml(cat.title)}</div>
      <div class="card-desc">${escapeHtml(cat.description||'')}</div>
    `;
    el.onclick = ()=> { if(cat.url) navigateTo(cat.url); };
    cardGrid.appendChild(el);
  });
  const add = document.createElement('div');
  add.className = 'add-card';
  add.innerText = '+';
  add.onclick = openModal;
  cardGrid.appendChild(add);
}

function loadOrInitCategories(){
  if(!categories){ categories = defaultCats.slice(); saveCategories(); }
  renderCategories(categories);
}

function navigateTo(url){
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:white;opacity:0;z-index:9999;transition:opacity 0.6s ease';
  document.body.appendChild(overlay);
  setTimeout(()=> overlay.style.opacity = '1', 10);
  setTimeout(()=> window.location.href = url, 600);
}

/* modal actions */
openAdd.onclick = openModal;
modalCancel.onclick = closeModal;
modalSave.onclick = saveModal;
modal.addEventListener('click', (e)=> { if(e.target === modal) closeModal(); });
function openModal(){
  cardTitle.value = '';
  cardDesc.value = '';
  cardUrl.value = '';
  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
  setTimeout(()=> cardTitle.focus(), 300);
}
function closeModal(){
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
}
function saveModal(){
  const title = cardTitle.value.trim();
  const desc = cardDesc.value.trim();
  let url = cardUrl.value.trim();
  if(!title || !desc || !url) { alert('Please fill in all fields.'); return; }
  if(!/^https?:\/\//i.test(url)) url = 'https://' + url;
  const id = title.toLowerCase().replace(/\s+/g,'_').replace(/[^\w]/g,'') || 'custom';
  if(categories.find(c=>c.id === id)){
    alert('A category with this title already exists. Please choose a different title.');
    return;
  }
  categories.push({ id, title, description: desc, url });
  saveCategories();
  renderCategories(categories);
  closeModal();
}
/* search */
searchInput.addEventListener('input', (e)=>{
  const q = e.target.value.trim().toLowerCase();
  if(!q){ renderCategories(categories); return; }
  const filtered = categories.filter(c=> c.title.toLowerCase().includes(q) || (c.description && c.description.toLowerCase().includes(q)) );
  renderCategories(filtered);
});
/* theme toggle */
let darkMode = false;
themeToggle.onclick = ()=>{
  darkMode = !darkMode;
  document.body.classList.toggle('dark', darkMode);
  saveSettings();
  updatePetalColors();
};
function loadSettings(){
  try{
    const s = localStorage.getItem('zen_hub_settings');
    if(s){
      const obj = JSON.parse(s);
      if(obj.darkMode) {
        darkMode = true;
        document.body.classList.add('dark');
      }
    }
  } catch(e){}
}
function saveSettings(){
  const obj = { darkMode };
  localStorage.setItem('zen_hub_settings', JSON.stringify(obj));
}
function updatePetalColors(){
  const petals = document.querySelectorAll('.sakura-petal');
  petals.forEach(petal => {
    petal.innerHTML = `<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><ellipse cx="16" cy="16" rx="15" ry="8" fill="${darkMode ? '#ff6f91' : '#ffb7d5'}"/><ellipse cx="16" cy="16" rx="8" ry="15" fill="${darkMode ? '#a14a76' : '#ff6f91'}" opacity="0.5"/></svg>`;
  });
}
loadSettings();
updatePetalColors();

window.addEventListener('DOMContentLoaded', updatePetalColors);
</script>
</body>
</html>
